# NB-Curator's Pantry, Shelves, and Cans

## Overview

NB-Curator uses two primary storage locations for information:

- **nbc-live**:  This directory stores the isolated curator and target environments during initial installation.  Environments are archived to pantry shelves and later unarchived to restore them in a live environment.
- **nbc-pantry**: This directory contains a collection of **shelves**. Each shelf holds shared, read-only static assets (notebooks, data, etc.) and one or more micromamba-environment archives referred to as **cans**.

While all users have their own nbc-live directories, only hub admins and team admins have write access to shared pantries. Creating a new shelf in the pantry is how you prepare for events like webinars or conferences, or set up shared team environments.

## NBC-Live Directory Structure

The **NB-Curator Live Directory** is relatively simple and contains the following key components:

- **micromamba**: The single-file binary for the micromamba program.
- **envs**:  This directory stores micromamba-environment archives as individual subdirectories.
- **cache**:  This directory stores micromamba cache files for faster access during installations.
- **envs/pkgs**: This directory caches `uv` packages for faster access during installations.
- **temps**: This directory stores files generated by nb-curator to support installation tools.

## NBC-Pantry Structure

The **NB-Curator Pantry** is a collection of staged, notebook-centric analysis environments, each referred to as a "shelf".  Each shelf provides a complete environment for running a specific set of notebooks.

### Shelf Structure

#### Live Assets

Each shelf contains several read-only assets intended for shared use by all users of the shelf. These include:

- **Notebooks**: Jupyter notebooks specifically designed to work with the shelf's Python environment.
- **Notebook Input Data**: Data directories and files used as read-only inputs to the notebooks.
- **Environment Variables**: Configuration settings specific to the shelf.

#### Frozen Assets

Each shelf also contains frozen assets, designed to be unpacked onto faster storage media for quicker access. These include:

- **Cans**: A compressed archive of a single, curated environment.  Because cans are single compressed files, they unpack very quickly, even when transferred from EFS.  This speed is crucial for reducing installation times during both curation and later operations. Using cans enables faster installations on local storage compared to EFS.

### Pantry Scenarios / Configurations

Depending on how two environment variables (NBC_ROOT and NBC_PANTRY) are set, the nbc-live runtime and nbc-pantry
shelf archive can be stored in different locations. In containerized environments, the pantry
is typically stored on long-lived storage and the curator runtime and installed environments may
or may not be on volatile storage.

#### Personal Installations on Laptop

For personal installations on a laptop, the curator runtime and installed environments are stored on local storage. 
The pantryboth curation and live environments,  as well as the pantry, nominally are stored in fast,
non-volatile storage. This is typically the case for

```/bin/bash
NBC_ROOT=${HOME}/.nbc-live
NBC_PANTRY=${HOME}/.nbc-pantry
```

#### Science Platform System Installations

```/bin/bash
NBC_ROOT=/opt/nbc-live  (located in "image" space)
NBC_PANTRY=/teams/users/nbc-pantry
```

#### Science Platform Team Installations

NBC_ROOT=/opt/nbc-live  (located in "image" space)
NBC_PANTRY=/teams/<your-team>/nbc-pantry

#### Science Platform Personal Environments

NBC_ROOT=/opt/nbc-live  (located in "image" space)
NBC_PANTRY=${HOME}/.nbc-pantry


### Deployment Scenarios

#### Install from spec inputs / curate

#### Install from spec outputs / reproduce

#### Re-install from Can / binary archive